(()=>{async function e(e){e.preventDefault();const s=e.currentTarget,o=s.querySelector("button.wp-block-popper-form-button");o.classList.toggle("loading");try{const{id:e}=s.dataset,n=new FormData(s);n.append("action","popper"),n.append("_nonce",popper._nonce),n.append("id",e);const c=await fetch(popper.ajaxUrl,{method:"POST",body:n}),a=await c.json();o.classList.toggle("loading"),t(a,s)}catch(e){n(e,s),o.classList.toggle("loading")}}const t=(e,t)=>{const{data:o}=e,{redirect:c}=t.dataset;if(c&&e.success)return window.location=c,!1;o&&n(e,t),o.hide&&e.success&&(t.style.display="none"),e.success&&(s("form-success"),t.reset())},n=(e,t)=>{const n=t.querySelector(".popper-message"),s=e.success?"success":"error";n.classList.remove(...n.classList),n.classList.add("popper-message",s);const{data:o}=e;if(n.innerHTML="<p>"+o.message+"</p>",o.errors?.length){const e=document.createElement("ul");n.appendChild(e),o.errors.forEach((function(t){const n=document.createElement("li");e.appendChild(n),n.innerHTML+=t}))}t.insertAdjacentElement("afterend",n)},s=e=>{window.dispatchEvent(new CustomEvent("popper-"+e))};document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelectorAll(".wp-block-popper-form");t.length&&t.forEach((t=>{t.addEventListener("submit",e)}))}))})();